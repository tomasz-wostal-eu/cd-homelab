# EMQX 5.x Homelab Values
# Environment-specific configuration

replicaCount: 1

# EMQX Configuration
emqxConfig:
  # Dashboard password - change this!
  # Or use ExternalSecret to inject from Azure Key Vault
  EMQX_DASHBOARD__DEFAULT_PASSWORD: "changeme123"

  # Logging
  EMQX_LOG__CONSOLE__LEVEL: warning

  # MQTT Bridge from Home Assistant EMQX
  # Credentials loaded from secret via envFromSecret below
  EMQX_BRIDGES__MQTT__HA_BRIDGE__ENABLE: "true"
  EMQX_BRIDGES__MQTT__HA_BRIDGE__PROTO_VER: "v5"
  EMQX_BRIDGES__MQTT__HA_BRIDGE__CLEAN_START: "true"
  # Ingress: subscribe to all topics from HA and republish locally
  EMQX_BRIDGES__MQTT__HA_BRIDGE__INGRESS__REMOTE__TOPIC: "#"
  EMQX_BRIDGES__MQTT__HA_BRIDGE__INGRESS__REMOTE__QOS: "1"
  EMQX_BRIDGES__MQTT__HA_BRIDGE__INGRESS__LOCAL__TOPIC: "${topic}"
  EMQX_BRIDGES__MQTT__HA_BRIDGE__INGRESS__LOCAL__QOS: "${qos}"
  EMQX_BRIDGES__MQTT__HA_BRIDGE__INGRESS__LOCAL__RETAIN: "${retain}"

# Load bridge credentials from secret (keys must be EMQX env var names)
envFromSecret: "emqx-mqtt-bridge-credentials"

# Persistence using NFS StorageClass (RWX)
persistence:
  enabled: true
  storageClassName: nfs-rwx
  size: 1Gi
  accessMode: ReadWriteMany

# Ingress for Dashboard (optional)
# Uncomment to expose dashboard via ingress
# ingress:
#   dashboard:
#     enabled: true
#     ingressClassName: nginx
#     annotations:
#       cert-manager.io/cluster-issuer: letsencrypt-prod
#     hosts:
#       - host: emqx.homelab.local
#         paths:
#           - path: /
#             pathType: Prefix
#     tls:
#       - secretName: emqx-dashboard-tls
#         hosts:
#           - emqx.homelab.local

# Service - expose as LoadBalancer or NodePort if needed
# service:
#   type: LoadBalancer
#   annotations:
#     metallb.universe.tf/address-pool: default

# Resources for homelab
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi
