# Mimir configuration for homelab - SINGLE BINARY MODE
# All components run in one pod for simplicity and lower resource usage

# Deployment mode - monolithic (single binary)
deploymentMode: monolithic

# Mimir configuration
mimir:
  structuredConfig:
    common:
      storage:
        backend: filesystem
        filesystem:
          dir: /data/mimir

    # Limits configuration
    limits:
      # Ingestion limits
      ingestion_rate: 50000
      ingestion_burst_size: 500000
      max_global_series_per_user: 300000
      max_global_series_per_metric: 100000
      max_label_names_per_series: 50
      max_label_value_length: 2048
      # Allow out-of-order samples
      out_of_order_time_window: 30m

      # Query limits
      max_fetched_series_per_query: 50000
      max_fetched_chunks_per_query: 2000000

      # Retention
      compactor_blocks_retention_period: 168h  # 7 days

    # Blocks storage
    blocks_storage:
      backend: filesystem
      filesystem:
        dir: /data/mimir/blocks
      tsdb:
        dir: /data/mimir/tsdb

    # Ruler storage
    ruler_storage:
      backend: filesystem
      filesystem:
        dir: /data/mimir/ruler

    # Alertmanager storage
    alertmanager_storage:
      backend: filesystem
      filesystem:
        dir: /data/mimir/alertmanager

    # Compactor configuration
    compactor:
      data_dir: /data/mimir/compactor

# Monolithic deployment (single binary)
mimir_monolithic:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 4Gi
  persistentVolume:
    enabled: true
    size: 10Gi
    storageClass: "nfs-rwx"
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/metrics"

# Disable all microservices components
ingester:
  replicas: 0
distributor:
  replicas: 0
querier:
  replicas: 0
query_frontend:
  replicas: 0
store_gateway:
  replicas: 0
compactor:
  replicas: 0

# Ruler disabled
ruler:
  enabled: false

# Alertmanager disabled
alertmanager:
  enabled: false

# Overrides exporter disabled
overrides_exporter:
  enabled: false

# Query scheduler disabled
query_scheduler:
  enabled: false

# Nginx gateway - still needed for routing
nginx:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Minio disabled - using filesystem
minio:
  enabled: false

# Caches disabled for simplicity
chunks-cache:
  enabled: false
index-cache:
  enabled: false
metadata-cache:
  enabled: false
results-cache:
  enabled: false

# Rollout operator disabled
rollout_operator:
  enabled: false

# Monitoring
metaMonitoring:
  dashboards:
    enabled: false
  serviceMonitor:
    enabled: false
  prometheusRule:
    enabled: false
