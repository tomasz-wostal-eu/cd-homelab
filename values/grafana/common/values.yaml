# Grafana common config
replicas: 1

service:
  type: ClusterIP
  port: 80

# Dashboard providers configuration
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: 'kubernetes'
        orgId: 1
        folder: 'Kubernetes'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/kubernetes
      - name: 'grafana-stack'
        orgId: 1
        folder: 'Grafana Stack'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/grafana-stack
      - name: 'argocd'
        orgId: 1
        folder: 'ArgoCD'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/argocd
      - name: 'istio'
        orgId: 1
        folder: 'Istio Service Mesh'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/istio
      - name: 'envoy-gateway'
        orgId: 1
        folder: 'Envoy Gateway'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/envoy-gateway
      - name: 'cert-manager'
        orgId: 1
        folder: 'Cert Manager'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/cert-manager
      - name: 'external-secrets'
        orgId: 1
        folder: 'External Secrets'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/external-secrets
      - name: 'argo-workflows'
        orgId: 1
        folder: 'Argo Workflows'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/argo-workflows
      - name: 'emqx'
        orgId: 1
        folder: 'EMQX'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/emqx
      - name: 'cnpg'
        orgId: 1
        folder: 'CloudNative PG'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/cnpg
      - name: 'sealed-secrets'
        orgId: 1
        folder: 'Sealed Secrets'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/sealed-secrets

# Dashboards from Grafana.com and URLs
dashboards:
  kubernetes:
    api-server:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/refs/heads/master/dashboards/k8s-system-api-server.json
    core-dns:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/refs/heads/master/dashboards/k8s-system-coredns.json
    views-global:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/refs/heads/master/dashboards/k8s-views-global.json
    views-namespaces:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/refs/heads/master/dashboards/k8s-views-namespaces.json
    views-nodes:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/refs/heads/master/dashboards/k8s-views-nodes.json
    views-pods:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/refs/heads/master/dashboards/k8s-views-pods.json
    k3s-cluster:
      gnetId: 16450
      revision: 1
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus

  grafana-stack:
    # Loki dashboards
    loki-operational:
      url: https://raw.githubusercontent.com/grafana/loki/main/production/loki-mixin-compiled/dashboards/loki-operational.json
      datasource: Prometheus
    loki-reads:
      url: https://raw.githubusercontent.com/grafana/loki/main/production/loki-mixin-compiled/dashboards/loki-reads.json
      datasource: Prometheus
    loki-writes:
      url: https://raw.githubusercontent.com/grafana/loki/main/production/loki-mixin-compiled/dashboards/loki-writes.json
      datasource: Prometheus
    # Tempo dashboards
    tempo-operational:
      url: https://raw.githubusercontent.com/grafana/tempo/main/operations/tempo-mixin-compiled/dashboards/tempo-operational.json
      datasource: Prometheus
    tempo-reads:
      url: https://raw.githubusercontent.com/grafana/tempo/main/operations/tempo-mixin-compiled/dashboards/tempo-reads.json
      datasource: Prometheus
    tempo-writes:
      url: https://raw.githubusercontent.com/grafana/tempo/main/operations/tempo-mixin-compiled/dashboards/tempo-writes.json
      datasource: Prometheus
    # Alloy dashboard
    alloy-monitoring:
      gnetId: 21377
      revision: 1
      datasource: Prometheus

  argocd:
    argocd-operational-overview:
      gnetId: 19993
      revision: 6
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
    argocd-application-overview:
      gnetId: 19974
      revision: 6
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
    argocd-notifications-overview:
      gnetId: 19975
      revision: 8
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus

  istio:
    istio-mesh-dashboard:
      gnetId: 7639
      revision: 245
      datasource: Prometheus
    istio-control-plane-dashboard:
      gnetId: 7645
      revision: 245
      datasource: Prometheus
    istio-service-dashboard:
      gnetId: 7636
      revision: 245
      datasource: Prometheus
    istio-workload-dashboard:
      gnetId: 7630
      revision: 245
      datasource: Prometheus
    istio-ztunnel-dashboard:
      gnetId: 21306
      revision: 48
      datasource: Prometheus

  envoy-gateway:
    envoy-gateway-overview:
      gnetId: 24460
      revision: 1
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus
    envoy-gateway-global:
      url: https://raw.githubusercontent.com/envoyproxy/gateway/main/charts/gateway-addons-helm/dashboards/envoy-gateway-global.json
      datasource: Prometheus
    envoy-proxy-global:
      url: https://raw.githubusercontent.com/envoyproxy/gateway/main/charts/gateway-addons-helm/dashboards/envoy-proxy-global.json
      datasource: Prometheus

  cert-manager:
    cert-manager:
      gnetId: 20842
      revision: 3
      datasource: Prometheus

  external-secrets:
    external-secrets:
      gnetId: 21640
      revision: 4
      datasource:
        - name: DS_METRICS
          value: Prometheus
        - name: DS_PROMETHEUS
          value: Prometheus

  argo-workflows:
    argo-workflows:
      gnetId: 20348
      revision: 4
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus

  emqx:
    emqx-dashboard:
      gnetId: 17446
      revision: 2
      datasource:
        - name: DS_PROMETHEUS
          value: prometheus

  cnpg:
    cnpg-cluster:
      gnetId: 20417
      revision: 4
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus

  sealed-secrets:
    sealed-secrets:
      gnetId: 14192
      revision: 4
      datasource:
        - name: DS_PROMETHEUS
          value: Prometheus

# Sidecar configuration for auto-loading dashboards
sidecar:
  dashboards:
    enabled: true
    label: grafana_dashboard
    folder: /tmp/dashboards
    defaultFolderName: null
    searchNamespace: ALL

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 472
  runAsGroup: 472
  fsGroup: 472
