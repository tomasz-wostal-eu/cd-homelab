# Grafana homelab
persistence:
  enabled: false

admin:
  existingSecret: homelab-grafana-credentials
  userKey: admin-user
  passwordKey: admin-password

# Load InfluxDB token from secret as env var
envFromSecrets:
  - name: homelab-grafana-datasource-secrets
    optional: false

# Enable sidecar to auto-load dashboards from ConfigMaps
sidecar:
  dashboards:
    enabled: true
    label: grafana_dashboard
    labelValue: "1"
    folder: /tmp/dashboards
    provider:
      foldersFromFilesStructure: false

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: InfluxDB
        type: influxdb
        uid: influxdb
        url: http://influxdb-influxdb2.monitoring.svc.cluster.local:80
        access: proxy
        isDefault: false
        jsonData:
          version: Flux
          organization: homelab
          defaultBucket: mqtt
        secureJsonData:
          token: $__env{influxdb-token}
      - name: Prometheus
        type: prometheus
        uid: Prometheus
        url: http://prometheus-server.monitoring.svc:80
        access: proxy
        isDefault: true
        jsonData:
          httpMethod: POST
      - name: Loki
        type: loki
        uid: loki
        url: http://loki.monitoring.svc:3100
        access: proxy
        jsonData:
          maxLines: 1000
      - name: Tempo
        type: tempo
        uid: tempo
        url: http://tempo.monitoring.svc:3200
        access: proxy
        jsonData:
          tracesToLogs:
            datasourceUid: loki
            filterByTraceID: true
            filterBySpanID: false
          tracesToMetrics:
            datasourceUid: prometheus
          serviceMap:
            datasourceUid: prometheus
          nodeGraph:
            enabled: true
          lokiSearch:
            datasourceUid: loki

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi
