# Grafana homelab
persistence:
  enabled: true
  storageClassName: nfs-rwx
  size: 1Gi

# Security context for NFS
securityContext:
  runAsUser: 472
  runAsGroup: 472
  fsGroup: 472

# Disable init container (fsGroup handles permissions)
initChownData:
  enabled: false

admin:
  existingSecret: homelab-grafana-credentials
  userKey: admin-user
  passwordKey: admin-password

# Load InfluxDB token from secret as env var
envFromSecrets:
  - name: homelab-grafana-datasource-secrets
    optional: false

# Enable sidecar to auto-load dashboards from ConfigMaps
sidecar:
  dashboards:
    enabled: true
    label: grafana_dashboard
    labelValue: "1"
    folder: /tmp/dashboards
    provider:
      foldersFromFilesStructure: false

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: InfluxDB
        type: influxdb
        url: http://influxdb-influxdb2.monitoring.svc.cluster.local:80
        access: proxy
        isDefault: true
        jsonData:
          version: Flux
          organization: homelab
          defaultBucket: mqtt
        secureJsonData:
          token: $__env{influxdb-token}

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi
