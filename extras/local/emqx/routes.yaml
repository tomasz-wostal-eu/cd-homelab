---
# TCPRoute for MQTT plain (port 1883)
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TCPRoute
metadata:
  name: emqx-mqtt
  namespace: emqx
spec:
  parentRefs:
    - name: emqx-gateway
      sectionName: mqtt
  rules:
    - backendRefs:
        - name: emqx
          port: 1883
---
# TLSRoute for MQTT over TLS (port 8883)
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TLSRoute
metadata:
  name: emqx-mqtts
  namespace: emqx
spec:
  parentRefs:
    - name: emqx-gateway
      sectionName: mqtts
  rules:
    - backendRefs:
        - name: emqx
          port: 1883  # Backend is plain MQTT, TLS terminated at gateway
---
# TCPRoute for MQTT WebSocket (port 8083)
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TCPRoute
metadata:
  name: emqx-ws
  namespace: emqx
spec:
  parentRefs:
    - name: emqx-gateway
      sectionName: ws
  rules:
    - backendRefs:
        - name: emqx
          port: 8083
---
# TLSRoute for MQTT WebSocket Secure (port 8084)
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TLSRoute
metadata:
  name: emqx-wss
  namespace: emqx
spec:
  parentRefs:
    - name: emqx-gateway
      sectionName: wss
  rules:
    - backendRefs:
        - name: emqx
          port: 8083  # Backend is plain WS, TLS terminated at gateway
---
# HTTPRoute for Dashboard HTTPS (port 18083)
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: emqx-dashboard
  namespace: emqx
spec:
  parentRefs:
    - name: emqx-gateway
      sectionName: dashboard
  rules:
    - backendRefs:
        - name: emqx
          port: 18083
